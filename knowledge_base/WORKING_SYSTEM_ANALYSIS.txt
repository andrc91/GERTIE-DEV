===========================================
GERTIE WORKING ORIGINAL SYSTEM ANALYSIS
===========================================
Generated: 2024
Purpose: Reference document for fixing video streaming issues

CRITICAL DIFFERENCES DISCOVERED
================================
1. FUNCTION DUPLICATION
   - Working Original: ONE handle_video_commands() at line 485
   - Current System: TWO definitions (line 553 and 763) - NOW FIXED
   
2. UDP HANDLER STRUCTURE
   - Working: Clean single implementation
   - Current: Had conflicting duplicates

WORKING SYSTEM STRUCTURE
========================
Location: /Users/andrew1/Desktop/working original/camera_system_integrated_final copy/

Core Components:
1. slave/video_stream.py
   - Lines: ~750 total
   - handle_video_commands: Line 485 (SINGLE instance)
   - Port: 5004 for rep1-7, 5011 for rep8
   - Key features: UDP listener, streaming thread management
   
2. slave/still_capture.py
   - Port: 6000 (verified)
   - Command handler present and functional
   
3. master/camera_gui/
   - AUTO_START_STREAMS setting
   - Network manager for command dispatch
   
KEY FUNCTIONAL PATTERNS
=======================
1. Device Detection:
   - Uses hostname-based detection
   - Falls back to IP mapping
   
2. UDP Command Flow:
   - Master sends to port 5004/5011
   - Slave listens and spawns threads
   - START_STREAM → start_stream()
   - STOP_STREAM → stop_stream()
   
3. Video Streaming:
   - Uses Picamera2 for capture
   - Sends to master on port 5002
   - Frame transforms applied inline
   
4. Settings Management:
   - JSON files per device (rep1_settings.json, etc.)
   - Applied on stream start
   
CRITICAL SUCCESS REQUIREMENTS
=============================
1. Single UDP handler function (no duplicates)
2. Correct port bindings (5004/5011 for commands)
3. Threading for command handling
4. AUTO_START_STREAMS = True
5. Inline transforms (no external imports)

VALIDATION CHECKLIST
===================
□ No duplicate functions
□ UDP handler at correct location
□ Port 5004 binding successful
□ Threading.Thread calls present
□ Settings files readable
□ Network connectivity to master

COMMON FAILURE POINTS
=====================
1. Duplicate function definitions
2. Wrong port variables
3. Missing threading
4. Import errors
5. Indentation issues

DEPLOYMENT VERIFICATION
=======================
After fixes, verify:
1. grep -c "def handle_video_commands" should return 1
2. Service should show "listening on port 5004"
3. START_STREAM commands should trigger video
4. No Python syntax errors
