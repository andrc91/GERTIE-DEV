# DEPLOYMENT via sync_to_slaves.sh ONLY

Date: Tue Oct 14 15:35:00 BST 2025
Commit: 9eaceb2 - Fix: Remove double-resize, enable proper exclusive mode video enlargement

## MANDATORY STEPS (NO ALTERNATIVES):
1. Copy camera_system_integrated_final to USB drive
2. On control1 Pi: cp -r /media/USB/camera_system_integrated_final /home/andrc1/
3. cd /home/andrc1/camera_system_integrated_final
4. ./sync_to_slaves.sh
5. ./run_gui_with_logging.sh
6. Test: Start video streams from all cameras
7. Test: Press keys 1-8 to enter exclusive mode - VERIFY VIDEO ENLARGES TO FULL SIZE
8. Test: Check video quality - should be SHARP, not pixelated/blurry
9. Test: Press key 0 to return to grid mode
10. Test: Capture still images in both modes
11. cp /home/andrc1/Desktop/updatelog.txt /media/USB/
12. Return updatelog.txt to MacBook for analysis

## CRITICAL FIX DETAILS:
**Problem**: Double-resize causing poor quality in exclusive mode
  - process_video_frame() pre-downscaled to 320x240 using NEAREST (low quality)
  - update_video_display_safe() tried to upscale from 320x240 → 960x720
  - Result: Video enlarged but blurry/pixelated (upscaling small image)

**Impact**: 
  - Exclusive mode video was enlarged but unusable for manual focusing
  - Quality degradation made fine focus adjustments impossible
  - Users couldn't effectively use exclusive mode for its intended purpose

**Solution**: Single-resize path preserving original quality
  - process_video_frame() now passes ORIGINAL full-resolution image (no pre-resize)
  - update_video_display_safe() does ALL sizing decisions:
    * Exclusive mode: 960x720 downscaled from ORIGINAL with LANCZOS (sharp)
    * Grid mode: 320x240 downscaled from ORIGINAL with LANCZOS (sharp)
  - Result: High quality resize in both modes, no double-processing

**Files Changed**: master/camera_gui/core/network_manager.py only
  - Removed lines 175-197: Complex pre-resize logic
  - Added lines 175-176: Comments explaining new approach
  - Modified line 205: Grid mode now explicitly resizes from original
  - Uses LANCZOS resampling for best quality

## Expected Result:
✓ Video streaming visible from all cameras (rep1-rep8)
✓ Exclusive mode (keys 1-8): VIDEO ENLARGED AND SHARP - suitable for manual focusing
✓ Grid mode (key 0): Normal 320x240 previews - adequate quality
✓ NO pixelation/blur in exclusive mode
✓ Smooth video updates with no performance degradation
✓ Manual camera focusing possible with high-quality enlarged preview

## BEFORE vs AFTER:

**Before (commit b381049)**:
Original (e.g. 640x480) → NEAREST downscale to 320x240 → LANCZOS upscale to 960x720
= Blurry/pixelated exclusive view (upscaling from small)

**After (commit 9eaceb2)**:
Original (e.g. 640x480) → LANCZOS downscale to 960x720 (exclusive) or 320x240 (grid)
= Sharp exclusive view (downscaling from original)

## TESTING PRIORITY:
1. **CRITICAL**: Verify exclusive mode video is SHARP and CLEAR
   - Press number keys 1-8 to enter exclusive mode for each camera
   - Video should fill more screen space (960x720 instead of 320x240)
   - Quality should be HIGH - suitable for manual focusing
   - Text/details in video should be readable
   
2. **Verify**: Grid mode performance unchanged
   - Press 0 to return to grid mode
   - All 8 cameras show small previews (320x240)
   - Smooth updates, no lag
   
3. **Test**: Still capture works in both modes
   - Capture in grid mode
   - Enter exclusive mode, capture there too
   - Both should produce full-resolution images

## DO NOT:
- Use any other deployment method besides sync_to_slaves.sh
- Run individual scp commands to cameras
- Modify sync_to_slaves.sh script
- Skip testing exclusive mode quality - this is the PRIMARY FIX
- Proceed without verifying video is sharp in exclusive mode

## IF VIDEO STILL BLURRY IN EXCLUSIVE MODE:
1. Verify commit 9eaceb2 was actually deployed (check git log on Pi)
2. Check if services restarted properly after sync
3. Check updatelog.txt for any errors during deployment
4. Return updatelog.txt to MacBook immediately
5. Do NOT attempt manual fixes on Pi hardware

## SUCCESS CRITERIA:
✅ All 8 cameras show live video preview
✅ **Exclusive mode video is SHARP and HIGH QUALITY** (can focus manually)
✅ Grid mode shows normal quality small previews
✅ No errors in updatelog.txt
✅ Video enlargement is immediately visible when pressing number keys
✅ Capture button works in both grid and exclusive modes

## TECHNICAL BACKGROUND:
This fix resolves a quality degradation issue introduced when video resize logic was added.
The original implementation resized twice:
1. Network thread: Original → 320x240 (NEAREST - fast but low quality)
2. GUI thread: 320x240 → 960x720 (LANCZOS - high quality but can't restore lost detail)

New implementation resizes once:
- GUI thread: Original → 960x720 or 320x240 (LANCZOS - preserves quality)

Single resize from original = better quality, cleaner code, same performance.
